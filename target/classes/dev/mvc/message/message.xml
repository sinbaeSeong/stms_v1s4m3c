<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "dev.mvc.message.MessageMapperInter">
  
  <!-- Create -->
  <insert id="create" parameterType='MessageVO'>
    INSERT INTO message(sender, sender_uno, title, mcontent, uno, tno, mdate)
    VALUES (#{sender}, #{sender_uno}, #{title}, #{mcontent}, #{uno}, #{tno}, now())
  </insert>
  
  <!-- List -->
  <select id="list" resultType='MessageVO'>
    SELECT mno, sender, mdate, uno, tno, title, sender_uno
    FROM message
    ORDER BY mno ASC
  </select>  

<!--  검색 갯수 세는 카운트 -->
  <select id="count" resultType="int" parameterType="HashMap" >
    SELECT COUNT(*) as cnt
    FROM message
    WHERE uno=#{uno}
        <choose>
           <when test="col == 'sender'">
                 sender LIKE #{word}
           </when>
           <when test="col == 'title'">
                title LIKE #{word}
           </when>
        </choose>
  </select>
  
  <!-- Search + Paging List -->
  <select id="list2" resultType="MessageVO" parameterType="HashMap" >
           SELECT mno, sender, mdate, uno, tno, title, sender_uno
           FROM message
           WHERE uno=#{uno }
                         <choose>
                             <when test="col == 'sender'">
                                   sender LIKE #{word}
                             </when>
                             <when test="col == 'title'">
                                  title LIKE #{word}
                             </when>
                         </choose>
            ORDER BY mno DESC
            LIMIT #{offset}, 10;
  </select>  
  
  
  <!-- Read -->
  <select id="read" resultType='MessageVO'  parameterType='int'>
    SELECT mno, sender, sender_uno, mcontent, mdate, uno, tno, title
    FROM message
    WHERE mno = #{mno}
  </select>
  
  <!-- Delete -->
  <delete id="delete" parameterType='int'>
    DELETE FROM message
    WHERE mno = #{mno}
  </delete>

</mapper>
  